<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"null-ecp.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Weison&#39;s Blog">
<meta property="og:url" content="http://null-ecp.github.io/page/2/index.html">
<meta property="og:site_name" content="Weison&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Weison">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://null-ecp.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Weison's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Weison's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/null-ecp" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://null-ecp.github.io/java/Spring-Ioc.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avator.jpg">
      <meta itemprop="name" content="Weison">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Weison's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/java/Spring-Ioc.html" class="post-title-link" itemprop="url">通过解耦合来了解IOC</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-05-22 15:05:56 / 修改时间：16:54:45" itemprop="dateCreated datePublished" datetime="2019-05-22T15:05:56+08:00">2019-05-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这段时间在学习SSM框架 , 今天开始弄Spring , 看了一下Spring的一些相关介绍 , 了解到Spring的核心是IOC(控制反转) 和 AOP (切面编程).</p>
<ol>
<li><p>IOC(控制反转) 能干什么东西 ?<br>第一次看到这个有点懵逼 , 晚上找了点资料 , 有点理解, 这个东西 , 简单来说就是解决程序之间的强耦合关系 , 也就是松耦.</p>
</li>
<li><p>代码的耦合又是什么 ?<br>代码的耦合度过高就会造成 , 项目维护困难 , 在某一个点上进行修改, 会对一系列的代码造成影响 , 这个就是代码的耦合</p>
</li>
</ol>
<h2 id="耦合解读"><a href="#耦合解读" class="headerlink" title="耦合解读"></a><code>耦合</code>解读</h2><p>举一个比较简单的例子</p>
<p>我们在使用JDBC连接数据库 : </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 首先注册驱动</span></span><br><span class="line">DriverManager.registerDriver(<span class="keyword">new</span> com.mysql.jdbc.Driver());</span><br><span class="line"><span class="comment">// 2. 获取连接</span></span><br><span class="line">Connection conn = DriverManager.getConnection(<span class="string">&quot;url&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line"><span class="comment">// 3. 获取预处理sql语句对象</span></span><br><span class="line"><span class="comment">// 4. 获取查询结果集</span></span><br><span class="line"><span class="comment">// 5. 关闭连接</span></span><br></pre></td></tr></table></figure>
<p>这个步骤下来 , 没错吧 . 可是 , 如果mysql-jdbc这个包没有导入的情况下 , 直接在预编译阶段就会直接显示异常 . 程序直接运行不了.</p>
<p>这个就是我们所说的代码的耦合性 , 在一个地方修改后 , 会引起一系列的问题.</p>
<p>可能有些人看到到这里会有些奇怪 , 为什么我这里写注册驱动是用的<code>DriverManager.registerDriver(new com.mysql.jdbc.Driver());</code><br>这个就是以前注册驱动的方法 , 至于为什么会修改 , 想必原因也都清楚了吧 . 然后我们换用现在的类加载器的方法来注册驱动重新跑一遍试试:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 首先注册驱动</span></span><br><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"><span class="comment">// 2. 获取连接</span></span><br><span class="line">Connection conn = DriverManager.getConnection(<span class="string">&quot;url&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line"><span class="comment">// 3. 获取预处理sql语句对象</span></span><br><span class="line"><span class="comment">// 4. 获取查询结果集</span></span><br><span class="line"><span class="comment">// 5. 关闭连接</span></span><br></pre></td></tr></table></figure>
<p>大家都发现了 , 换成这种后 , 由于我们注册驱动的那串关键字换成了字符串 , 所以在编译阶段必不会出现异常了 , 然后我们跑一遍会发现 , 其实还是会报错的 <code>ClassNotFoundException</code> , 这是由于我们把jar包给删除的原因</p>
<p>但是这样 , 也就解决我们代码的耦合 , 修改代码 , 并不会造成其他代码块的问题 (预编译阶段)</p>
<p>也就是说 , 通过<code>new</code>关键字 , 会使我们的代码的耦合程度提高 , 需要解耦合 使用 反射就可以了</p>
<p>但是 , 我们使用<code>Class.forName()</code>类加载器来反射创建的时候 , 由于字符串固定!! 代码的变通性又降低</p>
<p>一旦 ,我们更换数据库 , 就又需要修改源码<br>其实这个问题挺好解决 , 我们可以增加一个配置文件 , 然后通过读取配置文件的方式来修改.</p>
<h2 id="自定义工厂模式解耦合"><a href="#自定义工厂模式解耦合" class="headerlink" title="自定义工厂模式解耦合"></a>自定义工厂模式解耦合</h2><p>这里我们来简单模拟一下我们平时不用框架来开发web .</p>
<p>假定需要完成一个用户注册 </p>
<p>这里我们创建一个主函数模拟前台页面 , 创建一个services业务层 , 创建一个Dao 持久层.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模拟前台注册页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Class register&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// services全局变量</span></span><br><span class="line">	<span class="keyword">private</span> UserServices userservices = <span class="keyword">new</span> UserServicesImpl();</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		User user = <span class="keyword">new</span> User();</span><br><span class="line">		user.setName(<span class="string">&quot;weison&quot;</span>);</span><br><span class="line">		<span class="comment">// 调用事务层保存</span></span><br><span class="line">		userservices.save(user);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * User事务层</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Class UserServicesImpl implements UserServices&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// userDao 全局变量</span></span><br><span class="line">	<span class="keyword">private</span> UserDao userdao = <span class="keyword">new</span> UserDaoImpl();</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">		userdao.save(user);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * User 持久层</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Class UserDaoImpl implements UserDao&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">		System.out.println(user.getName()+<span class="string">&quot;   注册成功&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以发现 , 在显示层 , 和 事务层中, 我们都创建了一个私有全局变量 , 来完成接下来的事务操作.</p>
<p>那么这里的问题就显而易见了 , 假定我们修改了Dao或者修改了services , 都会造成在前台页面中无法运行的情况 , 也就是编译期的错误.</p>
<p>解决办法也很简单 , 就和前面分析的一样 , 使用 反射和配置文件来完成.</p>
<p>创建一个配置文件<code>bean.properties</code> , 用<code>key=value</code>的形式配置 , key为变量名 , value为全限定类名</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">userservices</span>=<span class="string">com.weison.services.impl.UserServicesImpl</span></span><br><span class="line"><span class="attr">userdao</span>=<span class="string">com.weison.dao.impl.UserDaoImpl</span></span><br></pre></td></tr></table></figure>
<p>创建一个工厂类 , 用于生产获取对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 工厂类 用于获取变量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanFactory</span></span>&#123;</span><br><span class="line">	<span class="comment">// 创建静态变量 , 以便于在静态代码块中执行</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Properties prop;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 使用静态代码块完成读取配置</span></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//实例化对象</span></span><br><span class="line">            prop = <span class="keyword">new</span> Properties();</span><br><span class="line">            <span class="comment">//获取properties文件的流对象</span></span><br><span class="line">            InputStream in = BeanFactory.class.getClassLoader().getResourceAsStream(<span class="string">&quot;bean.properties&quot;</span>);</span><br><span class="line">            prop.load(in);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ExceptionInInitializerError(<span class="string">&quot;初始化properties失败！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据传入的变量名获取对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getBean</span><span class="params">(String beanName)</span></span>&#123;</span><br><span class="line">        Object bean = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String beanPath = prop.getProperty(beanName);</span><br><span class="line"><span class="comment">//            System.out.println(beanPath);</span></span><br><span class="line">            bean = Class.forName(beanPath).newInstance();<span class="comment">//每次都会调用默认构造函数创建对象</span></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>好了 , 这里就完成工厂类的创建 , 然后我们就可以在之前的代码中做修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 显示层 main中</span></span><br><span class="line"><span class="keyword">private</span> UserServices userservices = (UserServices)BeanFactory.getBean(<span class="string">&quot;userservices&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 事务层 services中</span></span><br><span class="line"><span class="keyword">private</span> UserDao userdao = (UserDao)BeanFactory.getBean(<span class="string">&quot;userdao&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>可以看到 , 这样操作后 , 我们就算进行修改或者删除 , 都不会对我们的代码预编译的结果造成影响.</p>
<h3 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h3><p>但是这里又有一个问题出现 , 这里我在main中进行修改 : </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++) &#123;</span><br><span class="line">	UserServices us = (UserServices) BeanFactory.getBean(<span class="string">&quot;userservices&quot;</span>);</span><br><span class="line">	System.out.println(as);</span><br><span class="line">	as.saveAccount();</span><br></pre></td></tr></table></figure>
<p>运行结果</p>
<p><img src="/images/runtest.png" alt="runtest"></p>
<p>可以看到 , 这不是我们所希望的结果 ,因为循环五次获取对象, 获取到了五个不同的对象, 这对我们的内存是一个很大的浪费, 由于java的内存回收机制, 这些对象的内存需要在很长一段时间后才会被回收.</p>
<p>并且, 我们可以判断出 , 我们内部维持的这些变量都是极少或者不会出现更改的.</p>
<p>这里我们就可以对工厂类进行修改 , 给对象的获取给定一个固定的值 . 让我们传入参数 , 工厂每次返回的都是同一个对象 . </p>
<p>那么 , 我们需要怎么给工厂类进行修改 ? 直接添加成员变量么 , 这个是可行的 , 但是 , 一旦工厂类需要生产的对象多了起来 , 或者后期需要添加新的生产对象的时候 , 我们就需要再次修改源码进行成员变量的添加 , 这并没有从根本上解决问题 . </p>
<p>其实 , 我们可以在工厂类中 , 创建一个Map集合 , 然后以索引名(变量名)也就是配置文件的key , 作为key , 通过反射创建出来的对象作为value , 这样 , 在工厂类中 , 每个对应的对象都只会维持一份, 再次获取都会从集合中进行获取 . </p>
<p>对 工厂类进行修改 : </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个Map,用于存放我们要创建的对象。我们把它称之为容器</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String,Object&gt; beans;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重构初始化静态代码块</span></span><br><span class="line"><span class="comment">//使用静态代码块为Properties对象赋值</span></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//实例化对象</span></span><br><span class="line">		props = <span class="keyword">new</span> Properties();</span><br><span class="line">		<span class="comment">//获取properties文件的流对象</span></span><br><span class="line">		InputStream in = BeanFactory.class.getClassLoader().getResourceAsStream(<span class="string">&quot;bean.properties&quot;</span>);</span><br><span class="line">		props.load(in);</span><br><span class="line">		<span class="comment">//实例化容器</span></span><br><span class="line">		beans = <span class="keyword">new</span> HashMap&lt;String,Object&gt;();</span><br><span class="line">		<span class="comment">//取出配置文件中所有的Key</span></span><br><span class="line">		Enumeration keys = props.keys();</span><br><span class="line">		<span class="comment">//遍历枚举</span></span><br><span class="line">		<span class="keyword">while</span> (keys.hasMoreElements())&#123;</span><br><span class="line">			<span class="comment">//取出每个Key</span></span><br><span class="line">			String key = keys.nextElement().toString();</span><br><span class="line">			<span class="comment">//根据key获取value</span></span><br><span class="line">			String beanPath = props.getProperty(key);</span><br><span class="line">			<span class="comment">//反射创建对象</span></span><br><span class="line">			Object value = Class.forName(beanPath).newInstance();</span><br><span class="line">			<span class="comment">//把key和value存入容器中</span></span><br><span class="line">			beans.put(key,value);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> ExceptionInInitializerError(<span class="string">&quot;初始化properties失败！&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//重构获取对象方法</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据bean的名称获取对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> beanName</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getBean</span><span class="params">(String beanName)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> beans.get(beanName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们再次进行测试 :<br><img src="/images/beantest.png" alt="beantest"></p>
<p>可以发现 , 这里输出的就全都是同一个变量了 .</p>
<p>到这里 , 如果有用过Spring的同学可以发现 , 这个和Spring的对象获取很相似了</p>
<p>没错 , 其实spring内部也就是靠工厂模式和单例设计模式来完成IOC的 .</p>
<h2 id="IOC解读"><a href="#IOC解读" class="headerlink" title="IOC解读"></a>IOC解读</h2><p>像我们家里如果有用不着的电器商品啊 什么的 , 如果想卖掉 , 肯定不是我们直接去找卖家吧 , 我们都是直接去找 中介出售 , 或者挂在二手交易网 , 让这个三方平台来完成销售 , 然后需要买的人, 他们就会通过这些三方平台来完成购买 , 而我们(卖家) 和 买家 之间 从始至终都没有进行过联系 .<br>这个和我们开发设计代码有一定到的相似性 . </p>
<ul>
<li>在最开始我们编写代码 :<br>我们(卖家)就像声明变量 , 然后要去自己找对应的 对象引用(买家).</li>
<li>然后有了二手交易平台(工厂类)介入:<br>我们(卖家)就只要直接去找二手交易平台(工厂类) , 把我们需要或者出售的商品告诉它 , 然后工厂类就会帮我们完成操作 , 最后把需要的东西给我们.</li>
</ul>
<h2 id="IOC的实现原理"><a href="#IOC的实现原理" class="headerlink" title="IOC的实现原理"></a>IOC的实现原理</h2><p>通过上文我们知道，IOC更多的是思想性的，具体的实现可以说是DI，或者换句话说：在系统运行的过程中，如何动态的向某个对象提供它所需要的对象，就是IOC容器通过依赖注入的方式来实现的。</p>
<p>在Spring中，Spring是一个对象工厂，当对象A需要对象B的时候，会有容器提供，程序员不用关心对象的创建只需要说明对象之间的互相依赖关系即可，之间的协作均有容器控制。</p>
<p>Spring容器或者工厂通过反射来创建需要的对象，这里我们需要了解的就是工厂设计模式和反射。我们通过配置文件将需要生产的对象的信息进行定义，在运行时候，Spring工厂会通过反射生成配置文件定义的类的对应的对象。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://null-ecp.github.io/java/String.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avator.jpg">
      <meta itemprop="name" content="Weison">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Weison's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/java/String.html" class="post-title-link" itemprop="url">深入了解String,StringBuilder,StringBuffer</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-12 19:04:57" itemprop="dateCreated datePublished" datetime="2019-05-12T19:04:57+08:00">2019-05-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-19 00:34:30" itemprop="dateModified" datetime="2019-10-19T00:34:30+08:00">2019-10-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="String-字符串常量"><a href="#String-字符串常量" class="headerlink" title="String 字符串常量"></a>String 字符串常量</h2><p>po出<code>String</code>的源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">String</span>&gt;, <span class="title">CharSequence</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** The value is used for character storage. */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value[];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里可以看得出 <code>String</code> 内部实现其实就是一个不可变的<code>char</code>类型的数组</p>
<p>再来看看 <code>String</code> 的几个方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">substring</span><span class="params">(<span class="keyword">int</span> beginIndex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (beginIndex &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(beginIndex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> subLen = value.length - beginIndex;</span><br><span class="line">    <span class="keyword">if</span> (subLen &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(subLen);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (beginIndex == <span class="number">0</span>) ? <span class="keyword">this</span> : <span class="keyword">new</span> String(value, beginIndex, subLen);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">concat</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> otherLen = str.length();</span><br><span class="line">    <span class="keyword">if</span> (otherLen == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> len = value.length;</span><br><span class="line">    <span class="keyword">char</span> buf[] = Arrays.copyOf(value, len + otherLen);</span><br><span class="line">    str.getChars(buf, len);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(buf, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">replace</span><span class="params">(<span class="keyword">char</span> oldChar, <span class="keyword">char</span> newChar)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (oldChar != newChar) &#123;</span><br><span class="line">        <span class="keyword">int</span> len = value.length;</span><br><span class="line">        <span class="keyword">int</span> i = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">char</span>[] val = value; <span class="comment">/* avoid getfield opcode */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (++i &lt; len) &#123;</span><br><span class="line">            <span class="keyword">if</span> (val[i] == oldChar) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; len) &#123;</span><br><span class="line">            <span class="keyword">char</span> buf[] = <span class="keyword">new</span> <span class="keyword">char</span>[len];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">                buf[j] = val[j];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (i &lt; len) &#123;</span><br><span class="line">                <span class="keyword">char</span> c = val[i];</span><br><span class="line">                buf[i] = (c == oldChar) ? newChar : c;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(buf, <span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从上面三个方法可以看的出 , 无论是<code>subString</code>还是<code>replace</code>亦或是<code>concat</code>都是重新创建了一个<code>String</code>字符串 , 并没有对原字符串进行修改.</p>
<p>在这永远要记住一点：<strong>对String对象的任何改变都不会影响到原对象，相关的任何更改操作都会生成新对象。</strong></p>
<h2 id="StringBuilder-amp-StringBuffer"><a href="#StringBuilder-amp-StringBuffer" class="headerlink" title="StringBuilder &amp; StringBuffer"></a>StringBuilder &amp; StringBuffer</h2><ul>
<li><code>StringBuilder</code> : 字符串变量 // 线程不安全</li>
<li><code>StringBuffer</code>  : 字符串变量 // 线程安全</li>
</ul>
<p>那么 , 既然已经有了<code>String</code>作为字符串类 , 为什么还会派生出 <code>StringBuilder</code>和<code>StringBuffer</code>两个类呢</p>
<p>先来看看下面这段代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringDemo</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        String s = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6666</span>; i++)&#123;</span><br><span class="line">            s += <span class="string">&quot;weison&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里的<code>s += &quot;weison&quot;</code> , 相当于每次循环都重新声明一个字符串变量来拼接原始字符串</p>
<p>来看看反编译之后的代码 :<br><img src="/images/String.png" alt="反编译的String代码"></p>
<p>这段反编译后的class文件可以很明显的看出整个循环的执行过程 :</p>
<ol>
<li>每次循环先<code>new</code>出一个<code>StringBuilder</code>对象</li>
<li>然后对<code>StringBuilder</code>对象进行<code>append</code>操作</li>
<li>最后将这个<code>StringBuilder</code>对象进行<code>toString</code>操作</li>
</ol>
<p>就是最后这个<code>toString</code>的操作 , 这让这个循环完毕后, 整整<code>new</code>了6666个对象 , 可想而知 , 这些对象没有被回收的话 , 是多大的一笔开销.</p>
<p>从反编译后的代码可以看出 <code>s += &quot;weison&quot;;</code> 这句操作 实际上被JVM自动优化成了下面这串代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">StringBuilder str = <span class="keyword">new</span> StringBuilder(s);</span><br><span class="line">str.append(<span class="string">&quot;weison&quot;</span>);</span><br><span class="line">s = str.toString();</span><br></pre></td></tr></table></figure>
<p>再来看看下面这段代码 :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringDemo</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6666</span>; i++)&#123;</span><br><span class="line">            sb.append(<span class="string">&quot;weison&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看看反编译后的代码 :<br><img src="/images/StringBuilder.png" alt="反编译的StringBuilder代码"><br>这一段代码可以看得出来 , <code>StringBuilder</code>对象是在循环外面就已经声明了的 , 这里的for循环一直是对这个<code>StringBuilder</code>对象进行<code>append</code>操作 , 因此 这段代码的资源占用明显要比上面的小很多.</p>
<p>但是 , 这里有衍生出了一个新的问题 :</p>
<p>为什么有了<code>StringBuilder</code>类 , 为什么还会有一个<code>StringBuffer</code>类 , 看过源码的同学都知道 , <code>StringBuffer</code>和<code>StringBuilder</code>的成员方法和属性基本一致.</p>
<p>但是 ! 在<code>StringBuffer</code>的成员方法上 , 多了一个关键字<code>synchronized</code> , 这个关键字可以在多线程中起到安全保护作用 , 也就是说<code>StringBuffer</code>是线程安全的.</p>
<p>再来看看下面这份代码 :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.weison.stringtest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        testString1();</span><br><span class="line">        testStringBuffer();</span><br><span class="line">        testStringBuilder();</span><br><span class="line">        testString2();</span><br><span class="line">        testString3();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testString1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String s = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            s += <span class="string">&quot;weison&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;testString1使用时间为：&quot;</span> + (end - start) + <span class="string">&quot;毫秒&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testStringBuffer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            sb.append(<span class="string">&quot;weison&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;testStringBuffer使用时间为：&quot;</span> + (end - start) + <span class="string">&quot;毫秒&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testStringBuilder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            sb.append(<span class="string">&quot;weison&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;testStringBuilder使用时间为：&quot;</span> + (end - start) + <span class="string">&quot;毫秒&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testString2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            String s = <span class="string">&quot;I&quot;</span>+<span class="string">&quot;am&quot;</span>+<span class="string">&quot;weison&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;字符串直接相加操作使用时间为：&quot;</span> + (end - start) + <span class="string">&quot;毫秒&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testString3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;I&quot;</span>;</span><br><span class="line">        String s2 = <span class="string">&quot;am&quot;</span>;</span><br><span class="line">        String s3 = <span class="string">&quot;weison&quot;</span>;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            String s = s1 + s2 + s3;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;字符串间接相加操作使用时间为：&quot;</span> + (end - start) + <span class="string">&quot;毫秒&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试结果 :</p>
<p><img src="/images/Stringtest.png" alt="Stringtest result"></p>
<p>在最开始的反编译解析中 , 有说过 <code>s += &quot;weison&quot;;</code> , JVM会自动优化 , 我们来看看下面这段代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.weison.stringtest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        testString1();</span><br><span class="line">        testString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testString1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String s = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            s += <span class="string">&quot;weison&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;testString1使用时间为：&quot;</span> + (end - start) + <span class="string">&quot;毫秒&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String s = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            StringBuilder sb = <span class="keyword">new</span> StringBuilder(s);</span><br><span class="line">            sb.append(<span class="string">&quot;weison&quot;</span>);</span><br><span class="line">            s=sb.toString();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;模拟jvm优化操作使用时间为：&quot;</span> + (end - start) + <span class="string">&quot;毫秒&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试结果 :<br><img src="/images/JVM.png" alt="模拟JVM的代码"></p>
<p>两个的执行时间都相当长 , 也可以看得出 , JVM在转换中也耗费了一部分的时间.</p>
<p>在这里对上面那几个方法进行推测和解析 :</p>
<ul>
<li><p>对于直接相加的字符串 , 可以看得出来效率非常高 , 这里可以推测String字符串在编译的时候对于直接拼接的字符串会直接进行拼接, 而不是先声明出几个字符串再进行拼接 . 即 : <code>&quot;i&quot; + &quot;am&quot; + &quot;weison&quot;;</code> , 这样的字符串相加 , 会在编译的时候直接优化成 <code>iamweison</code> , 这里看看反编译的结果 :</p>
</li>
<li><p>反编译结果 :<br><img src="/images/Stringadd.png" alt="Stirng拼接"></p>
</li>
<li><p>但是对于间接相加, 比如引用变量进行相加的 , 这种的效率要比字符串直接相加要低 , 因为编译器不会对引用变量进行优化.</p>
</li>
<li><p>反编译结果 :<br><img src="/images/valueadd.png" alt="Stirng引用变量拼接"></p>
</li>
<li><p><code>String</code>,<code>StringBuilder</code>,<code>StringBuffer</code>三者的执行效率:</p>
<ol>
<li><code>StringBuilder</code> &gt; <code>StringBuffer</code> &gt; <code>String</code></li>
<li>当然这个也不是一定的 : 比如像上面讲的直接拼接字符串 , 效率就肯定要比<code>StringBuilder</code>这种要高</li>
<li>在对字符串需要进行相当多的操作时候 , 可以使用<code>StringBuilder</code></li>
</ol>
</li>
<li><p>下面在来踩几个坑:</p>
<ol>
<li>下面这段代码输出结果?<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String a = “hello2″; 　　</span><br><span class="line">String b = “hello” + <span class="number">2</span>; 　　</span><br><span class="line">System.out.println((a == b));</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输出结果为: true;</span><br><span class="line">原因很简单的 , a为hello2 , b在编译器就自动优化成了hello2 ,而hello2在之前已经被创建并加入到常量池中 , 所以b这里指向的也是常量池中的hello2 , 所以返回为 true</span><br></pre></td></tr></table></figure></li>
<li>下面这段代码输出结果?<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String a = “hello2″;   　</span><br><span class="line">String b = “hello”;       </span><br><span class="line">String c = b + <span class="number">2</span>;       </span><br><span class="line">System.out.println((a == c));</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输出结果为 : false;</span><br><span class="line">由于这里c是由引用变量b和整型2相加的 , 所以 JVM并不会自动优化 , 这里就需要重新创建对象 , 所以c创建出来的对象是保存在堆内存上的 , 两个的内存地址指向不一样 , 所以这里结果为 false</span><br></pre></td></tr></table></figure></li>
<li>下面这段代码输出结果?<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String a = “hello2″;   　</span><br><span class="line"><span class="keyword">final</span> String b = “hello”;       </span><br><span class="line">String c = b + <span class="number">2</span>;       </span><br><span class="line">System.out.println((a == c));</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输出结果为 : true;</span><br><span class="line">由于被final修饰的变量 , 会在class文件的常量池中存在 , 也就是编译后会存在于常量池中 , 所以c &#x3D; b + 2; 这里 , 在编译阶段会被JVM解释成 -&gt; c &#x3D; &quot;hell0&quot; + 2; 这也就回到第一个问题 , 所以这里的结果还是 true</span><br></pre></td></tr></table></figure>
<blockquote>
<p>个人见解 , 若有不对的地方 , 可以一起讨论.</p>
</blockquote>
</li>
</ol>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://null-ecp.github.io/linux/as_per_denied.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avator.jpg">
      <meta itemprop="name" content="Weison">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Weison's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/linux/as_per_denied.html" class="post-title-link" itemprop="url">解决linux上android studio的虚拟机permissions denied</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-10-17 20:04:57" itemprop="dateCreated datePublished" datetime="2018-10-17T20:04:57+08:00">2018-10-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-09 20:40:38" itemprop="dateModified" datetime="2021-02-09T20:40:38+08:00">2021-02-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>之前有个备用的pixel用作测试，然后这几天借给朋友去了，无奈开虚拟机来测试，结果发现新建虚拟机的时候出现了<code>/dev/kvm/ permissions denied</code>的报错，想了下，去改了下这个目录的权限。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 777 /dev/kem</span><br></pre></td></tr></table></figure>
<p>嗯，再来一次就没有报错，完美解决。</p>
<p>不过可气的是，事情居然没有这么简单，第二天开电脑，再次启动虚拟机的时候居然又给我报错，权限不足。</p>
<p>想了下，不应该，这都已经写入了，为啥启动不了，然后重新给了下执行权限。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /dev/kvm</span><br></pre></td></tr></table></figure>
<p>然后重启了下，可以启动。</p>
<p>不放心，又关掉as重新启动一次，居然又是权限不足。</p>
<p>然后到看了下as的wiki：</p>
<blockquote>
<p>官方给的说法是安装kvm的时候是用的sudo临时提权，所以默认情况下kvm是属于root用户组，而每次启动都是以自己的用户来启动而我的用户又不是root也没和root同组。<br>so，每次打开都得临时提权</p>
</blockquote>
<p>下面来介绍下如何把当前用户添加进kvm所有者同组中</p>
<p>以防万一，先看看你有没有安装kvm：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install qemu-kvm</span><br></pre></td></tr></table></figure>
<p>检查下kvm的所有者：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -al /dev/kvm</span><br></pre></td></tr></table></figure>
<p>可以看到<code>root</code>是其所有者，然后我们看一下所有者同组中有什么成员：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep kvm /etc/group</span><br></pre></td></tr></table></figure>
<p>可以发现同组中并没有用户存在：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kvm:x:other_number:</span><br></pre></td></tr></table></figure>
<p>然后我们把当前用户给添加进kvm的所有者同组中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo adduser Username kvm</span><br><span class="line"><span class="meta">#</span><span class="bash">username是你自己的用户名</span></span><br></pre></td></tr></table></figure>
<p>然后再次查看同组用户，可以看到我们已经把用户添加进了所有者同组：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kvm:x:123:weison</span><br></pre></td></tr></table></figure>
<p>最后，我们只需要注销下当前用户就可以了，再次启动或者创建虚拟机就不会报错了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://null-ecp.github.io/hexo/auto_edit.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avator.jpg">
      <meta itemprop="name" content="Weison">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Weison's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/hexo/auto_edit.html" class="post-title-link" itemprop="url">'hexo new'自动打开md编辑器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-20 13:27:20" itemprop="dateCreated datePublished" datetime="2018-09-20T13:27:20+08:00">2018-09-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-09 20:23:41" itemprop="dateModified" datetime="2021-02-09T20:23:41+08:00">2021-02-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hexo/" itemprop="url" rel="index"><span itemprop="name">hexo</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在<code>Hexo</code>中新建一篇博文非常简单，只需要在命令行中键入以下命令然后回车即可：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new &quot;The title of your blog&quot;</span><br></pre></td></tr></table></figure>
<p>然后hexo就会在hexo的根目录下的<code>source</code>目录下的<code>_post</code>目录下自动创建相对应的md文件。然后我们只需要找到刚刚生成的文件进行编辑就可以了。</p>
<p>但是一旦文章比较多的情况下，我们就需要在成堆的md文件中找刚刚创建的博文，这就比较麻烦。</p>
<hr>
<p>好在hexo的github上有类似的issue，然后hexo作者也可给出了解决方法：</p>
<blockquote>
<p>ou can try to listen to the new event. For example:</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> exec = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).exec;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hexo 2.x</span></span><br><span class="line">hexo.on(<span class="string">&#x27;new&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">path</span>)</span>&#123;</span><br><span class="line">  exec(<span class="string">&#x27;vi&#x27;</span>, [path]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hexo 3</span></span><br><span class="line">hexo.on(<span class="string">&#x27;new&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">  exec(<span class="string">&#x27;vi&#x27;</span>, [data.path]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>根据作者给的示例给出了下列的解决方法：</p>
<ul>
<li>首先在<code>hexo</code>目录下的<code>script</code>目录下创建一个js脚本（没有的这个目录的话自己创建一个）。</li>
<li>js脚本的命名自定义，然后在脚本中写入以下代码。</li>
<li>windows端:  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> spawn = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).exec;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hexo 2.x 用户复制这段</span></span><br><span class="line">hexo.on(<span class="string">&#x27;new&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">path</span>)</span>&#123;</span><br><span class="line">  spawn(<span class="string">&#x27;start  &quot;markdown编辑器绝对路径.exe&quot; &#x27;</span> + path);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hexo 3 用户复制这段</span></span><br><span class="line">hexo.on(<span class="string">&#x27;new&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">  spawn(<span class="string">&#x27;start  &quot;markdown编辑器绝对路径.exe&quot; &#x27;</span> + data.path);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li>mac os端：  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> exec = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).exec;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hexo 2.x 用户复制这段</span></span><br><span class="line">hexo.on(<span class="string">&#x27;new&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">path</span>)</span>&#123;</span><br><span class="line">    exec(<span class="string">&#x27;open -a &quot;markdown编辑器绝对路径.app&quot; &#x27;</span> + path);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Hexo 3 用户复制这段</span></span><br><span class="line">hexo.on(<span class="string">&#x27;new&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    exec(<span class="string">&#x27;open -a &quot;markdown编辑器绝对路径.app&quot; &#x27;</span> + data.path);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
不过我在网上找了很久都没有发现有<code>linux</code>端的操作脚本，然后自己试着改了下，能在我的电脑(<code>debian/ubuntu</code>试过了没问题)上成功跑起来了，po下代码：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> exec = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).exec;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hexo 2.x 用户复制这段</span></span><br><span class="line">hexo.on(<span class="string">&#x27;new&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">path</span>)</span>&#123;</span><br><span class="line">    exec(<span class="string">&#x27;vim &#x27;</span> + path);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Hexo 3 用户复制这段</span></span><br><span class="line">hexo.on(<span class="string">&#x27;new&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    exec(<span class="string">&#x27;vim &#x27;</span> + data.path);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://null-ecp.github.io/linux/server.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avator.jpg">
      <meta itemprop="name" content="Weison">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Weison's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/linux/server.html" class="post-title-link" itemprop="url">linux下安装和配置jdk、tomcat</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-02 09:49:16" itemprop="dateCreated datePublished" datetime="2018-09-02T09:49:16+08:00">2018-09-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-09 20:23:57" itemprop="dateModified" datetime="2021-02-09T20:23:57+08:00">2021-02-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>emmm,大学狗今天正式上课，然后老师就已经讲好了期末作业，得交一个java web项目上去（想交个node.js的就舒服多了），于是还得把<code>tomcat</code>给弄起来，看看<code>java web</code>的书，来练练手呀。。</p>
<p>用的<code>debian</code>，配置这些专业程序的环境和安装还是比较方便的。</p>
<h1 id="安装jdk"><a href="#安装jdk" class="headerlink" title="安装jdk"></a>安装jdk</h1><ol>
<li>先查看下有没有安装openjdk</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l | grep openjdk</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>安装的话，使用下面命令卸载：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt  remove openjdk*</span><br></pre></td></tr></table></figure></li>
<li>jdk下载<a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">戳我进入下载页面</a></li>
</ol>
<p>进入官网后点 accept 然后找对应的系统版本的jdk下载即可。</p>
<ol start="4">
<li>然后将下载下来的压缩包解压到一个你找的到路径（我这里放到/usr/java下，并且重命名了）<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -xzf jdk-8u181-linux-x64.tar.gz -C /usr/java/</span><br><span class="line">sudo mv /usr/java/jdk1.8.0_181/ /usr/java/jdk</span><br></pre></td></tr></table></figure></li>
<li>配置环境变量</li>
</ol>
<p>linux中环境变量可以在以下几个文件中配置，不过不同的文件实现不同：<br>    - <code>/etc/envirnment</code>:配置的是整个系统的环境变量<br>    - <code>/etc/profile</code>:配置所有用户的环境变量<br>    - <code>~/.profile</code>:配置<em>当前</em>用户的环境变量<br>    - <code>~/.bashrc</code>:每次加载bash时加载的环境配置<br>so，我们可以在第一个or第二个里配置就好了。</p>
<blockquote>
<p>不过需要注意的是，在/etc/environment 中不能包含命令，即直接通过VAR=”…”的方式设置，不使用 export。而在/etc/profile中可以使用export来添加环境变量。</p>
</blockquote>
<p>然后直接在终端输入下面的命令就可以了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo echo &#x27;####JDK环境变量配置####</span><br><span class="line">export JAVA_HOME=/usr/java/jdk</span><br><span class="line">export JRE_HOME=$JAVA_HOME/jre</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib</span><br><span class="line">export PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH&#x27; &gt;&gt; /etc/profile</span><br></pre></td></tr></table></figure>
<p><em>请注意，JAVA_HOME为你解压的文件夹路径。（当然如果你和我上面写的一样就可以不用修改）</em></p>
<p>然后，<code>source /etc/profile</code>生效配置。</p>
<p>然后在终端输入<code>java -version</code>,如果输出是下面则成功了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java version &quot;1.8.0_181&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_181-b13)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode)</span><br></pre></td></tr></table></figure>
<p>如果多了一行<code>Picked up _JAVA_OPTIONS:   -Dawt.useSystemAAFontSettings=gasp</code>的话，输入以下代码（在终端）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo echo &#x27;unset _JAVA_OPTIONS&#x27; &gt;&gt; /etc/profile</span><br></pre></td></tr></table></figure>
<h1 id="安装tomcat"><a href="#安装tomcat" class="headerlink" title="安装tomcat"></a>安装tomcat</h1><p>由于我们已经配置好了jdk，所以可以直接来下载tomcat</p>
<ul>
<li><p>tomcat下载：<a target="_blank" rel="noopener" href="https://tomcat.apache.org/download-90.cgi">戳我进入下载页面</a> 选择.tar.gz这个。</p>
</li>
<li><p>解压文件到一个你能找的到目录下（这里解压到/usr/tomcat）：</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /usr/tomcat</span><br><span class="line">sudo tar -xzvf apache-tomcat-9.0.12.tar.gz -C /usr/tomcat</span><br><span class="line">sudo mv /usr/tomcat/apache-tomcat-9.0.12/* /usr/tomcat</span><br><span class="line">sudo rm -r /usr/tomcat/apache-tomcat-9.0.12</span><br></pre></td></tr></table></figure>
<ul>
<li>启动tomcat服务，进入解压目录下的<code>/bin</code>目录，运行<code>./startup.sh</code>,如果显示如下命令则，正常安装成功。<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Using CATALINA_BASE:   /usr/tomcat</span><br><span class="line">Using CATALINA_HOME:   /usr/tomcat</span><br><span class="line">Using CATALINA_TMPDIR: /usr/tomcat/temp</span><br><span class="line">Using JRE_HOME:        /usr</span><br><span class="line">Using CLASSPATH:       /usr/tomcat/bin/bootstrap.jar:/usr/tomcat/bin/tomcat-juli.jar</span><br><span class="line">Tomcat started.</span><br></pre></td></tr></table></figure>
<h1 id="处理报错"><a href="#处理报错" class="headerlink" title="处理报错"></a>处理报错</h1></li>
</ul>
<p>如果出现<code>java.net.ConnectException: 拒绝连接 (Connection refused)</code>报错的话。</p>
<ul>
<li>找到jdk的目录，找到该目录下<code>jre/lib/security</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/java/jdk/jre/lib/security</span><br></pre></td></tr></table></figure>
<ul>
<li>然后找到一个<code>java.security</code>的文件进行编辑：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">这里我是放在/usr目录下所以要root权限</span></span><br><span class="line">sudo vim java.security</span><br></pre></td></tr></table></figure></li>
<li>找到<code>securerandom.source=file:/dev/random</code>修改为<code>securerandom.source=file:/dev/./urandom</code></li>
</ul>
<p>然后保存退出，重新执行即可。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://null-ecp.github.io/push/FCM.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avator.jpg">
      <meta itemprop="name" content="Weison">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Weison's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/push/FCM.html" class="post-title-link" itemprop="url">FCM一键脚本</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-17 16:25:45" itemprop="dateCreated datePublished" datetime="2018-08-17T16:25:45+08:00">2018-08-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-09 20:40:38" itemprop="dateModified" datetime="2021-02-09T20:40:38+08:00">2021-02-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/push/" itemprop="url" rel="index"><span itemprop="name">push</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>由于腾讯家的即时通讯类app都是使用的自家的信鸽推送服务，这样造成了服务常驻，手机异常耗电，于是我们这里可以使用<code>FCM-for-Mojo</code>这款app来使用FCM消息推送通道</p>
<h1 id="执行脚本"><a href="#执行脚本" class="headerlink" title="执行脚本"></a>执行脚本</h1><p>连接你的vps，在终端输入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">先安装下git</span></span><br><span class="line"><span class="meta">#</span><span class="bash">这是centos安装git</span></span><br><span class="line">yum install git</span><br><span class="line"><span class="meta">#</span><span class="bash">这是ubuntu安装git</span></span><br><span class="line">apt-get update</span><br><span class="line">apt-get install git</span><br><span class="line"><span class="meta">#</span><span class="bash">这是Fedora</span></span><br><span class="line">dnf install git</span><br><span class="line"><span class="meta">#</span><span class="bash">获取脚本</span></span><br><span class="line">git clone https://github.com/null-ecp/FFM-one-step.git &amp;&amp; source ./FFM-one-step/FFM.sh</span><br></pre></td></tr></table></figure>
<blockquote>
<p>执行脚本后有些地方需要输入y或者序号进行选择，注意！</p>
</blockquote>
<p>待脚本执行完之后就安装完成了</p>
<h1 id="启动FFM"><a href="#启动FFM" class="headerlink" title="启动FFM"></a>启动FFM</h1><p>先看看在不在FFM目录下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pwd   #查看当前目录</span><br><span class="line"><span class="meta">#</span><span class="bash">如果返回为 /root/FCM-for-Mojo-Server 则没有问题</span></span><br><span class="line"><span class="meta">#</span><span class="bash">如果不是这个则输入以下命令</span></span><br><span class="line">cd /root/FCM-for-Mojo-Server</span><br></pre></td></tr></table></figure>
<p>确定在FFM目录下后输入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br><span class="line"><span class="meta">#</span><span class="bash">如果输入上述启动不了，你可以通过输入下面的命令启动</span></span><br><span class="line">perl /root/FCM-for-Mojo-Server/perl/start.pl</span><br></pre></td></tr></table></figure>
<h1 id="后台运行"><a href="#后台运行" class="headerlink" title="后台运行"></a>后台运行</h1><p>这里推荐使用screen或者systemd来维持后台</p>
<ol>
<li>systemd<br> 编辑systemd配置： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">Debian/Ubuntu</span></span><br><span class="line">vim /lib/systemd/system/fcm-for-mojo.service</span><br><span class="line"><span class="meta">#</span><span class="bash">CentOS/RedHat</span></span><br><span class="line">vim /usr/lib/systemd/system/fcm-for-mojo.service</span><br></pre></td></tr></table></figure>
 在文件内的配置填写如下： <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=FCM-for-Mojo Server</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=love4taylor</span><br><span class="line">WorkingDirectory=/home/love4taylor/FCM-for-Mojo-Server ExecStart=/usr/bin/npm start</span><br><span class="line">PrivateTmp=true</span><br><span class="line">Restart=on-failure</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
 然后启动systemd服务即可： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable fcm-for-mojo</span><br><span class="line">sudo systemctl start fcm-for-mojo</span><br></pre></td></tr></table></figure></li>
<li>screen<br> 使用screen需要先安装screen： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ubuntu/Debian</span></span><br><span class="line">apt-get install screen -y</span><br><span class="line"><span class="meta">#</span><span class="bash">CentOS</span></span><br><span class="line">yum install screen</span><br></pre></td></tr></table></figure>
 新建screen窗口： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">screen -S &quot;窗口名&quot; #创建窗口</span><br><span class="line"><span class="meta">#</span><span class="bash">进入ffm目录</span></span><br><span class="line">cd /root/FCM-for-Mojo-Server</span><br><span class="line"><span class="meta">#</span><span class="bash">启动ffm服务</span></span><br><span class="line">npm start</span><br></pre></td></tr></table></figure>
 待ffm成功运行后键入ctrt+a+d让screen进入后台运行。<br> 退出screen： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">screen -r &quot;窗口名&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash">ctrl+c结束ffm服务</span></span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
<h1 id="FFM更新"><a href="#FFM更新" class="headerlink" title="FFM更新"></a>FFM更新</h1></li>
</ol>
<p>更新相对来说简单多了，首先需要ctrl+c关闭FFM服务，然后进入ffm目录下。输入下面两条命令即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git pull</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Weison"
      src="/images/avator.jpg">
  <p class="site-author-name" itemprop="name">Weison</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">16</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Weison</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
